#!/usr/bin/env ruby
# frozen_string_literal: true

require 'pathname'

lib_dir = Pathname(__dir__).join('..', 'lib').expand_path
$LOAD_PATH.unshift lib_dir
require 'umts_training'

messages_file = File.open('messages.yml')
qualifications_file = File.open('qualifications.yml')
colaborators_file = File.open('colaborators.yml')

local_repo = UMTSTraining::LocalRepo.new Pathname(__dir__)
cli = UMTSTraining::CLI.new messages_file

cli.message 'create_client'
client = UMTSTraining::Client.new local_repo, cli
milestone = UMTSTraining::Milestone.new local_repo,
                                        client,
                                        qualifications_file

cli.message 'add_collabs'
colaborators = YAML.safe_load colaborators_file
client.add_collaborators! colaborators

cli.message 'create_issues'
milestone.create!
milestone.create_issues!

cli.message 'done'

messages_file.close
qualifications_file.close
colaborators_file.close
